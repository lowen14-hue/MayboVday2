<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Macrodata Refinement V-Day</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
<style>
body { margin:0; background:#001f4d; overflow:hidden; font-family: monospace; }
#lumon-logo {
  position:absolute; top:10px; left:50%; transform:translateX(-50%);
  font-size:32px; color:#fff; letter-spacing:4px; font-weight:bold; text-shadow:0 0 4px #0f0;
}
#bucket {
  position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
  font-size:22px; color:#fff; text-shadow:0 0 4px #0f0;
}
#message {
  position:absolute; top:40%; left:50%; transform:translate(-50%, -50%);
  font-size:32px; color:#ff4d6d; display:none; text-align:center;
}
canvas { display:block; }
.fly-number {
  position:absolute;
  color:#fff;
  font-family: monospace;
  font-weight:bold;
  pointer-events:none;
}
</style>
</head>
<body>

<div id="lumon-logo">LUMON</div>
<div id="bucket">Found: 0/6</div>
<div id="message">Makaylaâ€¦ will you be my Valentine! ðŸ’Œ</div>

<script>
// --- Macrodata-inspired variables ---
const sequences = [
  {digits:['0','9','2'], found:0},
  {digits:['1','1','8'], found:0},
  {digits:['2','0','5'], found:0},
  {digits:['4','0','2'], found:0},
  {digits:['3','1','9'], found:0},
  {digits:['5','8','3'], found:0}
];

let grid = [];
const rows = 15, cols = 25;
let cellW, cellH;

let dragging = false;
let dragStart = null;
let dragEnd = null;

function setup() {
  createCanvas(windowWidth, windowHeight);
  textAlign(CENTER,CENTER);

  cellW = width / cols;
  cellH = height / rows;

  // Create grid
  for(let y=0;y<rows;y++){
    for(let x=0;x<cols;x++){
      grid.push({
        baseX:x, baseY:y,
        wiggleX:0, wiggleY:0,
        val:floor(random(10)),
        important:false, picked:false,
        pulse:0
      });
    }
  }

  // Place sequences
  sequences.forEach(seq=>{
    let placed=false;
    while(!placed){
      let idx = floor(random(grid.length-3));
      if(idx%cols <= cols-3){
        for(let i=0;i<3;i++){
          let cell = grid[idx+i];
          cell.val = seq.digits[i];
          cell.important = true;
          cell.seq = seq;
        }
        placed=true;
      }
    }
  });
}

function draw() {
  background('#001f4d');

  // scanlines
  stroke(0,255,0,30);
  for(let y=0;y<height;y+=4) line(0,y,width,y);
  noStroke();

  // selection box
  if(dragging && dragStart && dragEnd){
    noFill();
    stroke(0,255,0);
    rect(dragStart.x, dragStart.y, dragEnd.x-dragStart.x, dragEnd.y-dragStart.y);
  }

  // draw numbers
  grid.forEach(cell=>{
    cell.wiggleX = random(-1,1);
    cell.wiggleY = random(-1,1);
    cell.pulse = 1 + (cell.important ? 0.3*sin(frameCount*0.05) : 0);

    let px = cell.baseX*cellW + cellW/2 + cell.wiggleX;
    let py = cell.baseY*cellH + cellH/2 + cell.wiggleY;
    let size = (cell.important ? 36 : 28) * cell.pulse;

    drawingContext.shadowColor = '#0f0';
    drawingContext.shadowBlur = random(2,4);

    fill(255);
    textSize(size);
    text(cell.val, px, py);

    cell.screenX = px;
    cell.screenY = py;
    cell.screenSize = size;
  });
}

function mousePressed() {
  dragging = true;
  dragStart = createVector(mouseX, mouseY);
  dragEnd = dragStart.copy();
}

function mouseDragged() {
  if(dragging) dragEnd = createVector(mouseX, mouseY);
}

function mouseReleased() {
  dragging = false;
  dragEnd = createVector(mouseX, mouseY);

  let x1 = min(dragStart.x, dragEnd.x);
  let x2 = max(dragStart.x, dragEnd.x);
  let y1 = min(dragStart.y, dragEnd.y);
  let y2 = max(dragStart.y, dragEnd.y);

  let bucket = document.getElementById('bucket');

  grid.forEach(cell=>{
    if(!cell.picked &&
       cell.screenX>=x1 && cell.screenX<=x2 &&
       cell.screenY>=y1 && cell.screenY<=y2){

      cell.picked = true;

      // Animate flying number
      let fly = document.createElement('div');
      fly.className = 'fly-number';
      fly.innerText = cell.val;
      fly.style.left = cell.screenX+'px';
      fly.style.top = cell.screenY+'px';
      fly.style.fontSize = (cell.important ? 36 : 28) + 'px';
      document.body.appendChild(fly);

      let bRect = bucket.getBoundingClientRect();
      setTimeout(()=>{
        fly.style.transition = 'all 0.7s ease-in-out';
        fly.style.left = (bRect.left + bRect.width/2) + 'px';
        fly.style.top = (bRect.top) + 'px';
        fly.style.transform = 'scale(0.5)';
        fly.style.opacity = '0.5';
      }, 10);
      setTimeout(()=>fly.remove(), 800);

      // Count important numbers
      if(cell.important) cell.seq.found++;

      bucket.innerText = `Found: ${sequences.filter(s=>s.found>=3).length}/6`;

      if(sequences.every(s=>s.found>=3)){
        document.getElementById('message').style.display='block';
      }
    }
  });
}
</script>
</body>
</html>
